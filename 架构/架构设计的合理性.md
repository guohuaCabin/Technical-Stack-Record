### 大项目的架构整治必要性



1. 团队规模变大导致的业务拆分不同
2. 代码的相对集中，代码的提交导致开发过程中团队沟通和相互等待造成的时间和资源浪费
3. 代码相互耦合，归属不清，影响到的问题排查的效率



### 想要的结果

1. 业务完全解耦
2. 通用功能沉淀
3. 不同的业务建立独立git仓库，生成单独的Pod库，最后聚集到一个壳工程中



### 选择开发模式

1. 苹果官方推荐MVC开发模式：非常适合个人开发和小团队开发
2. MVP、MVVM、MVCS模式：MVC衍生设计模式，它们在不同程度上增强了视图、数据的通信方式，使得逻辑、视图、数据之间的通信更灵活、规整、易于扩展
3. 项目规模变大，加单架构向大项目架构的演进 ：思考 --> 模块粒度应该如何划分？如何分层？多团队如何协作？



### 思考

#### 1.模块粒度如何划分？

1. 模块粒度采用遵循SOLID原则进行划分

   * **单一职责原则**：对象功能要单一，不要在一个对象里添加很多功能。
   * **开闭原则**：扩展是开放的，修改是封闭的。
   * **里氏替换原则**：子类对象是可以替代基类对象的。
   * **接口隔离原则**：接口的用途要单一，不要在一个接口上根据不同入参实现多个功能。
   * **依赖倒置原则**：方法应该依赖抽象，不要依赖实例。iOS 开发就是高层业务方法依赖于协议。

2. 选择合适的粒度

   大型项目的模块粒度过大或者过小都不合适。

   目前普遍使用的是组件化，组件是可组装的，独立的业务单元，具有高内聚，低耦合的特性，是一种比较适中的粒度。iOS组件应该包括UI控件、相关多个小功能的集合。

   * **梳理组件之间的逻辑关系**
     * 底层可以是与业务无关的基础组件，如网络、存储等
     * 中间层一般是通用的业务组件，如埋点、封装控件等
     * 最上层的是迭代业务组件，更新频率最高

3. 多团队之间如何分工

   目前我司的分工，个人觉得比较合理，简要介绍下：

   * 业务组件分配到个人，平时业务开发涉及模块找各组件负责人
   * 基础组件也分配到个人，在业务开发之余可以进行基础组件完善

   优势：基建团队就是业务团队，这样避免高屋建瓴，做到了基建服务于业务，团队分工比较灵活。

   缺点：目前比较适合团队成员较小的情况，对于使用到非成员自己负责的组件，往往会自行处理，未做到真正意义上的基建和业务分离。

   建议：团队较大的话还是要区分基建团队和业务团队，为了避免基建人员脱离业务，可以将基建人员流动化，从业务中来，再回到业务中去。

4. 好的架构模式

   组件话是解决项目达、人员多得一种很好的手段，这是没有歧义的。组件间关系协调却没有固定的标准，协调的优劣成为了衡量架构优劣的一个基本标准。

   在实践中，一般分为了协议式和中间者两种架构设计方案。

   * 协议式

     **协议式架构设计主要采用的是协议是编程的思路**：在编译层面使用协议定义规范，实现可在不同的地方，从而达到分布式管理和维护组件的目的。这种方式也遵循了依赖倒置原则，是一种很好的面向对象编程的实践。

     缺点：

     (1) 由于协议式编程缺少统一调度层，导致难于集中管理，特别是项目规模变大、团队变多的情况下，架构管控就会显得越来越重要。

     (2) 协议式编程接口定义模式过于规范，从而使得架构的灵活性不够高。当需要引入一个新的设计模式来开发时，我们就会发现很难融入到当前架构中，缺乏架构的统一性。

   * 中间者

     **中间者架构它采用中间者统一管理的方式，来控制 App 的整个生命周期中组件间的调用关系。**同时，iOS对于组件接口的设计也需要保持一致性，方便中间者统一调用。

     拆分的组件都会依赖于中间者，但是组间之间就不存在相互依赖的关系了。由于其他组件都会依赖于这个中间者，相互间的通信都会通过中间者统一调度，所以组件间的通信也就更容易管理了。在中间者上也能够轻松添加新的设计模式，从而使得架构更容易扩展。



好的架构一定是健壮的、灵活的。中间者架构的易管控带来的架构更稳固，易扩展带来的灵活性是比较让人推荐的。![中间者架构图](http://res.guohuaden.com/%E4%B8%AD%E9%97%B4%E8%80%85%E6%9E%B6%E6%9E%84%E5%9B%BE.png)

中间者架构思路设计 [**CTMediator**](https://github.com/casatwy/CTMediator)是一个很好的实现。demo:[ArchitectureDemo](https://github.com/ming1016/ArchitectureDemo)

推荐

1、[软件架构入门](http://www.ruanyifeng.com/blog/2016/09/software-architecture.html)

2、iOS应用架构谈系列

 	2.1  [开篇](https://casatwy.com/iosying-yong-jia-gou-tan-kai-pian.html) 

​	2.2  [view层的组织和调用方案](https://casatwy.com/iosying-yong-jia-gou-tan-viewceng-de-zu-zhi-he-diao-yong-fang-an.html)

​	2.3  [网络层设计方案](https://casatwy.com/iosying-yong-jia-gou-tan-wang-luo-ceng-she-ji-fang-an.html)

​	2.4  [本地持久化方案及动态部署](https://casatwy.com/iosying-yong-jia-gou-tan-ben-di-chi-jiu-hua-fang-an-ji-dong-tai-bu-shu.html)

​	2.5  [组件化方案](https://casatwy.com/iOS-Modulization.html)

